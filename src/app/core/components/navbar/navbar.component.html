<mat-toolbar color="primary">
  <div class="navbar-container">
    <!-- Left side: Home, App Title, and Language Selector -->
    <div class="navbar-left">
      <button
        mat-icon-button
        [routerLink]="homeLink"
        class="logo-button"
        [matTooltip]="'navbar.home' | transloco"
        matTooltipPosition="below"
      >
        <img src="/TMI-FullLogo-Transparent-512x512.png" alt="TMI Logo" class="tmi-logo" />
      </button>
      <span class="app-title" [transloco]="'navbar.appTitle'">TMI: Threat Modeling Improved</span>

      <!-- Language Selector -->
      <button mat-button [matMenuTriggerFor]="languageMenu" class="language-selector">
        <mat-icon>language</mat-icon>
        <span
          [transloco]="'common.language'"
          [translocoParams]="{ language: currentLanguage.localName }"
          >{{ currentLanguage.localName }}</span
        >
      </button>

      <mat-menu #languageMenu="matMenu">
        <button mat-menu-item *ngFor="let lang of languages" (click)="switchLanguage(lang)">
          <span [transloco]="'common.language'" [translocoParams]="{ language: lang.localName }">{{
            lang.localName
          }}</span>
        </button>
      </mat-menu>
    </div>

    <!-- Center: Navigation links -->
    @if (isAuthenticated) {
      <div class="navbar-nav">
        <button mat-button routerLink="/intake" routerLinkActive="active-link" class="nav-link">
          <mat-icon>assignment</mat-icon>
          <span [transloco]="'navbar.intake'">Intake</span>
        </button>
        <button mat-button routerLink="/dashboard" routerLinkActive="active-link" class="nav-link">
          <mat-icon>dashboard</mat-icon>
          <span [transloco]="'navbar.dashboard'">Dashboard</span>
        </button>
        <button
          mat-button
          routerLink="/triage"
          routerLinkActive="active-link"
          class="nav-link"
          [disabled]="!isSecurityReviewer"
        >
          <mat-icon>inbox</mat-icon>
          <span [transloco]="'triage.title'">Triage</span>
        </button>
        <button
          mat-button
          routerLink="/admin"
          routerLinkActive="active-link"
          class="nav-link"
          [disabled]="!isAdmin"
        >
          <mat-icon>admin_panel_settings</mat-icon>
          <span [transloco]="'navbar.admin'">Admin</span>
        </button>
      </div>
    }

    <!-- Right side: Server status, User info and logout button -->
    <div class="navbar-right">
      <!-- Feedback button -->
      <button
        mat-icon-button
        [matTooltip]="'navbar.feedback' | transloco"
        matTooltipPosition="below"
        (click)="openFeedbackUrl()"
        class="feedback-button"
      >
        <mat-icon fontSet="material-symbols-outlined">feedback</mat-icon>
      </button>

      <!-- WebSocket connection indicator -->
      @if (showWebSocketStatus) {
        <span
          [matTooltip]="getWebSocketStatusTooltip()"
          matTooltipPosition="below"
          matTooltipClass="multiline-tooltip"
          style="display: inline-block"
        >
          <button mat-icon-button [class]="getWebSocketStatusIconClass()" disabled>
            <mat-icon fontSet="material-symbols-outlined">{{ getWebSocketStatusIcon() }}</mat-icon>
          </button>
        </span>
      }

      <!-- Server connection indicator -->
      <span
        [matTooltip]="getServerStatusTooltip()"
        matTooltipPosition="below"
        matTooltipClass="multiline-tooltip"
        style="display: inline-block"
      >
        <button
          mat-icon-button
          [class]="getServerStatusIconClass()"
          [disabled]="
            serverConnectionStatus === ServerConnectionStatus.NOT_CONFIGURED ||
            serverConnectionStatus === ServerConnectionStatus.OFFLINE
          "
          (click)="openServerUrl()"
        >
          <mat-icon>{{ getServerStatusIcon() }}</mat-icon>
        </button>
      </span>

      <!-- User info and logout when authenticated -->
      @if (isAuthenticated) {
        <ng-container>
          <button
            mat-button
            (click)="openUserPreferences()"
            (contextmenu)="openUserProfileContextMenu($event)"
            class="user-profile-button"
            [matTooltip]="userEmail"
            matTooltipPosition="below"
            #userProfileButton
          >
            <mat-icon>person</mat-icon>
            <span>{{ username }}</span>
          </button>

          <!-- Hidden positioned trigger for context menu -->
          <div
            style="visibility: hidden; position: fixed"
            [style.left]="contextMenuPosition.x"
            [style.top]="contextMenuPosition.y"
          >
            <button
              mat-icon-button
              [matMenuTriggerFor]="userProfileContextMenu"
              #userProfileMenuTrigger="matMenuTrigger"
            ></button>
          </div>

          <!-- Context menu for user profile button -->
          <mat-menu #userProfileContextMenu="matMenu">
            @if (isDevelopmentMode) {
              <button mat-menu-item (click)="copyUserEmailToClipboard()">
                <mat-icon>content_copy</mat-icon>
                <span [transloco]="'navbar.copyUserEmail'">Copy User Email to Clipboard</span>
              </button>
            }
          </mat-menu>
          <button mat-button (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span [transloco]="'navbar.logoutButton'">Logout</span>
          </button>

          <!-- No additional navigation buttons needed as home button will navigate to threat models when authenticated -->
        </ng-container>
      }
    </div>
  </div>
</mat-toolbar>

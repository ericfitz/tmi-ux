<div class="login-container">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title>{{ 'login.title' | transloco }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <!-- Explanatory text -->
      <p class="login-explanation">{{ 'login.explanation' | transloco }}</p>

      <!-- Loading providers -->
      @if (providersLoading) {
        <div>
          <div class="providers-loading">
            <mat-spinner diameter="20"></mat-spinner>
            <p>{{ 'login.loadingProviders' | transloco }}</p>
          </div>
        </div>
      }

      <!-- Multiple providers -->
      @if (!providersLoading && availableProviders.length > 1) {
        <div>
          <p>{{ 'login.chooseMethod' | transloco }}</p>
          <div class="provider-buttons">
            <button
              mat-raised-button
              color="primary"
              *ngFor="let provider of availableProviders"
              (click)="login(provider.id)"
              [disabled]="isLoading"
              [attr.data-provider]="provider.id"
              class="provider-button"
            >
              @if (getProviderLogoPath(provider.id)) {
                <img
                  [src]="getProviderLogoPath(provider.id)"
                  [alt]="provider.name + ' logo'"
                  class="provider-logo"
                />
              }

              <span>{{ 'login.loginWith' | transloco }} {{ provider.name }}</span>
            </button>
          </div>
        </div>
      }

      <!-- Single provider auto-login -->
      @if (!providersLoading && availableProviders.length === 1 && isLoading) {
        <div>
          <div class="single-provider-loading">
            @if (getProviderLogoPath(availableProviders[0].id)) {
              <img
                [src]="getProviderLogoPath(availableProviders[0].id)"
                [alt]="availableProviders[0].name + ' logo'"
                class="provider-logo-large"
              />
            }

            <p>{{ 'login.loggingInWith' | transloco: { provider: availableProviders[0].name } }}</p>
            <mat-spinner diameter="20"></mat-spinner>
          </div>
        </div>
      }

      <!-- Single provider ready to login -->
      @if (!providersLoading && availableProviders.length === 1 && !isLoading) {
        <div>
          <p>{{ 'login.pleaseSignIn' | transloco }}</p>
          <button
            mat-raised-button
            color="primary"
            (click)="login(availableProviders[0].id)"
            class="single-provider-button"
            [attr.data-provider]="availableProviders[0].id"
          >
            @if (getProviderLogoPath(availableProviders[0].id)) {
              <img
                [src]="getProviderLogoPath(availableProviders[0].id)"
                [alt]="availableProviders[0].name + ' logo'"
                class="provider-logo"
              />
            }

            <span>{{ 'login.loginWith' | transloco }} {{ availableProviders[0].name }}</span>
          </button>
        </div>
      }

      <!-- No providers configured -->
      @if (!providersLoading && availableProviders.length === 0) {
        <div>
          <div class="no-providers">
            <span class="material-symbols-outlined warning-icon">warning</span>
            <p>{{ 'login.noProvidersConfigured' | transloco }}</p>
          </div>
        </div>
      }

      <!-- Error display -->
      @if (error) {
        <div class="error-message">
          <span class="material-symbols-outlined error-icon">error</span>
          @if (error.startsWith('login.')) {
            <span>{{ error | transloco }}</span>
          } @else {
            <span>{{ error }}</span>
          }
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>

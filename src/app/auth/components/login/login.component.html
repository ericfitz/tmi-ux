<div class="login-container">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title>{{ 'login.title' | transloco }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <!-- Session expired message -->
      @if (sessionExpired) {
        <div class="session-expired-message">
          <span class="material-symbols-outlined info-icon">info</span>
          <span>{{ 'login.sessionExpired' | transloco }}</span>
        </div>
      }

      <!-- Explanatory text -->
      <p class="login-explanation">{{ 'login.explanation' | transloco }}</p>

      <!-- Loading providers -->
      @if (providersLoading) {
        <div>
          <div class="providers-loading">
            <mat-spinner diameter="20"></mat-spinner>
            <p>{{ 'login.loadingProviders' | transloco }}</p>
          </div>
        </div>
      }

      <!-- Providers available -->
      @if (!providersLoading && (oauthProviders.length > 0 || samlProviders.length > 0)) {
        <div>
          <p>{{ 'login.chooseMethod' | transloco }}</p>

          <!-- OAuth Providers Section -->
          @if (oauthProviders.length > 0) {
            <div class="provider-section">
              <h3 class="provider-section-title">{{ 'login.oauthProvidersTitle' | transloco }}</h3>
              <div class="provider-buttons">
                <button
                  mat-raised-button
                  color="primary"
                  *ngFor="let provider of oauthProviders"
                  (click)="loginWithOAuth(provider.id)"
                  [disabled]="isLoading"
                  [attr.data-provider]="provider.id"
                  class="provider-button"
                >
                  @if (isFontAwesomeIcon(provider.id)) {
                    <i [class]="getFontAwesomeIcon(provider.id) + ' provider-logo-icon'"></i>
                  } @else {
                    <img
                      [src]="getProviderLogoPath(provider.id)"
                      [alt]="provider.name + ' logo'"
                      class="provider-logo"
                    />
                  }
                  <span>{{ 'login.loginWith' | transloco }} {{ provider.name }}</span>
                </button>
              </div>
            </div>
          }

          <!-- SAML Providers Section -->
          @if (samlProviders.length > 0) {
            <div class="provider-section">
              <h3 class="provider-section-title">{{ 'login.samlProvidersTitle' | transloco }}</h3>
              <div class="provider-buttons">
                <button
                  mat-raised-button
                  color="primary"
                  *ngFor="let provider of samlProviders"
                  (click)="loginWithSAML(provider.id)"
                  [disabled]="isLoading"
                  [attr.data-provider]="provider.id"
                  class="provider-button"
                >
                  @if (isFontAwesomeIcon(provider.id)) {
                    <i [class]="getFontAwesomeIcon(provider.id) + ' provider-logo-icon'"></i>
                  } @else {
                    <img
                      [src]="getSAMLProviderLogoPath(provider.id)"
                      [alt]="provider.name + ' logo'"
                      class="provider-logo"
                    />
                  }
                  <span>{{ 'login.loginWith' | transloco }} {{ provider.name }}</span>
                </button>
              </div>
            </div>
          }
        </div>
      }

      <!-- No providers configured -->
      @if (!providersLoading && oauthProviders.length === 0 && samlProviders.length === 0) {
        <div>
          <div class="no-providers">
            <span class="material-symbols-outlined warning-icon">warning</span>
            <p>{{ 'login.noProvidersConfigured' | transloco }}</p>
          </div>
        </div>
      }

      <!-- Error display -->
      @if (error) {
        <div class="error-message">
          <span class="material-symbols-outlined error-icon">error</span>
          @if (error.startsWith('login.')) {
            <span>{{ error | transloco }}</span>
          } @else {
            <span>{{ error }}</span>
          }
        </div>
      }
    </mat-card-content>
    <mat-card-actions>
      <button mat-button (click)="cancel()">
        {{ 'common.cancel' | transloco }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
